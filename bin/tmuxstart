#!/usr/bin/env bash

# Launch tmux
# -----------------------------------------------------------------------------
_launch_tmux() {
	local _TMUX_SESSION_NAME="${USER}_dev"
	local _SPLIT_WIDTH=35
	local _WINDOWS_DEV='Dev'
	local _WINDOWS_SYSOPS='SysOps'
	local _WINDOWS_RSS='Rss'

	# make sure tmux server is running
	tmux start-server

	# Determine if session is running
	tmux has-session -t "${_TMUX_SESSION_NAME}"
	if [[ "$?" != 0 ]]; then

		#  Launch session
		tmux -2 new-session -s "${_TMUX_SESSION_NAME}" -d -n "$_WINDOWS_DEV"

		# Second window
		# -------------
		tmux new-window -t "${_TMUX_SESSION_NAME}" -n "$_WINDOWS_RSS"

		# Open RSS
		tmux send-keys -t "${_TMUX_SESSION_NAME}" 'rss' Enter

		# Third window
		# -------------
		tmux new-window -t "${_TMUX_SESSION_NAME}" -n "$_WINDOWS_SYSOPS"

		# Split verticaly
		tmux split-window -h -p "$_SPLIT_WIDTH"

		# Go to dotfiles folder and update
		tmux send-keys -t "${_TMUX_SESSION_NAME}":3.2 'dot' Enter
		tmux send-keys -t "${_TMUX_SESSION_NAME}":3.2 'dotfiles' Enter

		# Select panel 1
		tmux select-pane -t "${_TMUX_SESSION_NAME}":3.1


		# Focus on first window
		tmux select-window -t "${_WINDOWS_DEV}"
	fi

	# Attach to session
	tmux -2 attach -t "${_TMUX_SESSION_NAME}"
}

_launch_tmux

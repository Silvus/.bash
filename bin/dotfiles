#!/usr/bin/env bash

# Variables
# ========================================================

# Dotfiles directory
DOTFILES_DIR="$HOME/.dotfiles"

I3_CONFIG_FILE="$HOME/.i3/config"

# Colors
_TXTCOLOR_GREEN=$(tput setaf 2)
_TXTCOLOR_BLUE=$(tput setaf 4)
_TXTCOLOR_RESET=$(tput sgr0)

# Functions
# ========================================================

# Echos
# --------------------------------------------------------
echo_header() {   echo -e "\n${_TXTCOLOR_BLUE}⦿ $@${_TXTCOLOR_RESET}"; }
print_success() {  printf "    ${_TXTCOLOR_GREEN}✔${_TXTCOLOR_RESET} %-20s %s \n" "$1" "${*:2}"; }

# Install
# ========================================================

# Launch dotfiles (python - next version)
# --------------------------------------------------------
"${DOTFILES_DIR}/bin/dotfiles.py"

# i3
# --------------------------------------------------------
if [[ -x "$(which i3 2>/dev/null)" ]]; then
	echo_header "i3"

	# Generated i3 config
	SCREEN_COUNT=$(xrandr -q | grep ' connected' | wc -l)
	print_success "i3 config" "generated (screens : $SCREEN_COUNT)"

	echo -e "# DO NOT EDIT THIS FILE BY HAND.\n# YOUR CHANGES WILL BE OVERWRITTEN !\n" > "$I3_CONFIG_FILE"
	cat "$DOTFILES_DIR/i3/config_main" >> "$I3_CONFIG_FILE"

	if [[ "$SCREEN_COUNT" -gt 1 ]]; then
		# Dual screen
		cat "$DOTFILES_DIR/i3/config_bar_dual" >> "$I3_CONFIG_FILE"
	else
		# Simple screen
		cat "$DOTFILES_DIR/i3/config_bar" >> "$I3_CONFIG_FILE"
	fi

	cat "$DOTFILES_DIR/i3/config_apps" >> "$I3_CONFIG_FILE"
fi

exit 0

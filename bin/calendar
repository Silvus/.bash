#!/usr/bin/env bash

# If run under Tmux, set title
if [[ -n "$TMUX" ]]; then
	tmux rename-window "Calendar"
fi

# Go to doc folder
if [[ -d "$SILVUSDOC" ]]; then
	cd "$SILVUSDOC"
else
	echo "$SILVUSDOC is not a folder"
	exit 1
fi

# Update
git pull origin master

# Sync with server
# vdirsyncer -c "/data/doc/.data/dav/vdirsyncer.conf" discover
# vdirsyncer -c "/data/doc/.data/dav/vdirsyncer.conf" sync

# Open khal
khal -c "/data/doc/.data/dav/khal.conf" "$@"

# Sync with server
vdirsyncer -c "/data/doc/.data/dav/vdirsyncer.conf" sync

# Autocommit
git add .
git commit -m "Autocommit Calendar $(date +'%d/%m/%Y %T')"

# If run under Tmux, unset title
if [[ -n "$TMUX" ]]; then
	tmux set-window-option -q automatic-rename
fi

exit 0

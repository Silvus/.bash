#!/usr/bin/env bash

# Create a new nginx host (DEV)
# Include /data/dev/$1/nginx.conf

if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi

# -z str: Returns True if the length of str is equal to zero.
if [ -z "$1" ]; then
	echo "Site name missing"
	exit 1
else
	# -h filename: True if file exists and is a symbolic link.
	# -f filename: Returns True if file, filename is an ordinary file.
	if [ -h "/etc/nginx/sites-enabled/$1" ] || [ -f "/etc/nginx/sites-enabled/$1" ]; then
		echo "$1 is already enabled"
		exit 1

	elif [ -f "/etc/nginx/sites-available/$1" ]; then
		echo "/etc/nginx/sites-available/$1 already exist"
		exit 1

	else
		if [ ! -f "/data/dev/$1/nginx.dev.conf" ]; then
			echo "File /data/dev/$1/nginx.dev.conf does not exist"
			exit 1
		else
			echo "Creating /etc/nginx/sites-available/$1..."

		    echo "
include /data/dev/$1/nginx.dev.conf;
" > "/etc/nginx/sites-available/$1"

			echo "Enabled $1"
			ln -s /etc/nginx/sites-available/$1 /etc/nginx/sites-enabled/$1

			echo "Reload Nginx config"
			service nginx reload

			exit 0
		fi
	fi
fi
